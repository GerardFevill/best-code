name: ğŸš€ Publish @cosmospark/best-code

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  publish:
    name: ğŸ“¦ Deploy to NPM
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        registry-url: 'https://registry.npmjs.org'
        
    - name: ğŸ§ª Test package
      run: npm test
        
    - name: âœ… Validate package structure
      run: npm pack --dry-run
      
    - name: ğŸ” Verify NPM authentication
      run: npm whoami
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
        
    - name: ğŸ“¤ Publish to NPM Registry
      run: npm publish --access public
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
        
    - name: ğŸ‰ Deployment Success
      run: |
        echo "ğŸ¯ @cosmospark/best-code successfully published!"
        echo ""
        echo "ğŸ“¦ NPM Package: https://www.npmjs.com/package/@cosmospark/best-code"
        echo "ğŸ“¥ Install: npm install @cosmospark/best-code"
        echo "ğŸ”— Repository: https://github.com/GerardFevill/best-code"
        echo "ğŸ“š Functions: hello, welcome, capitalize, slugify"
