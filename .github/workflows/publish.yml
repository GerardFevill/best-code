name: 🚀 Publish @cosmospark/best-code

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  publish:
    name: 📦 Deploy to NPM
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout repository
      uses: actions/checkout@v4
      
    - name: 🔧 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        registry-url: 'https://registry.npmjs.org'
        
    - name: 🧪 Test package
      run: npm test
        
    - name: ✅ Validate package structure
      run: npm pack --dry-run
      
    - name: 🔍 Verify NPM authentication
      run: npm whoami
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
        
    - name: 📤 Publish to NPM Registry
      run: npm publish --access public
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
        
    - name: 🎉 Deployment Success
      run: |
        echo "🎯 @cosmospark/best-code successfully published!"
        echo ""
        echo "📦 NPM Package: https://www.npmjs.com/package/@cosmospark/best-code"
        echo "📥 Install: npm install @cosmospark/best-code"
        echo "🔗 Repository: https://github.com/GerardFevill/best-code"
        echo "📚 Functions: hello, welcome, capitalize, slugify"
