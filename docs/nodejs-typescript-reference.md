# üìö Guide de R√©f√©rence Node.js + TypeScript

[![Node.js](https://img.shields.io/badge/Node.js-18%2B-green?logo=node.js)](https://nodejs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0%2B-blue?logo=typescript)](https://www.typescriptlang.org/)
[![Security](https://img.shields.io/badge/Security-Best%20Practices-red?logo=security)](https://nodejs.org/en/security/)
[![AI-Friendly](https://img.shields.io/badge/AI-Friendly-purple?logo=openai)](https://github.com/GerardFevill/best-code)

> Guide complet des bonnes pratiques pour d√©velopper des applications Node.js en TypeScript robustes, s√©curis√©es et maintenables.

## üéØ Objectif pour les IA

Ce document est con√ßu pour guider toute intelligence artificielle assistant le d√©veloppement logiciel, dans la g√©n√©ration, l'am√©lioration, ou la r√©vision de projets Node.js + TypeScript.

### ü§ñ L'IA doit :
- **Suivre** la structure et les conventions d√©crites
- **Favoriser** le refactoring s√ªr et progressif
- **G√©n√©rer** des commits atomiques et document√©s
- **Respecter** les bonnes pratiques de s√©curit√© et de typage
- **Ne jamais modifier** plusieurs responsabilit√©s en un seul commit
- **Proposer** des alternatives fonctionnelles (Result<T, E>, Option<T>)
- **Valider** la s√©curit√© avant toute suggestion de code

### üßë‚Äçüíª Pour les d√©veloppeurs :
Ces sections peuvent √™tre modifi√©es selon les besoins m√©tier, mais les suggestions IA doivent toujours se baser sur ces standards par d√©faut.

## üìã Table des Mati√®res

- [üèóÔ∏è Structure du Projet](#-structure-du-projet)
- [üíª Bonnes Pratiques de Codage](#-bonnes-pratiques-de-codage)
- [üß¨ Refactoring IA Progressif](#-refactoring-ia-progressif-smartrefactor)
- [üì¶ Gestion des D√©pendances](#-gestion-des-d√©pendances)
- [üõ°Ô∏è S√©curit√©](#Ô∏è-s√©curit√©)
- [üîÑ Compatibilit√© des Versions](#-compatibilit√©-des-versions)
- [üöÄ Pipeline CI/CD](#-pipeline-cicd)
- [üìò Lexique pour les Agents IA](#-lexique-pour-les-agents-ia)
- [üìñ Ressources](#-ressources)

---

## üèóÔ∏è Structure du Projet

### üìÅ Architectures Recommand√©es

#### üåê Serveur API/Web (Express, Fastify, etc.)

```
my-api-project/
‚îú‚îÄ‚îÄ src/                          # Code source TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ controllers/              # Contr√¥leurs HTTP
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # Logique m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # Mod√®les de donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ routes/                   # D√©finition des routes
‚îÇ   ‚îú‚îÄ‚îÄ middleware/               # Middlewares Express
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ types/                    # D√©finitions de types
‚îÇ   ‚îú‚îÄ‚îÄ config/                   # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ database/                 # Connexions DB, migrations
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # Point d'entr√©e serveur
‚îú‚îÄ‚îÄ dist/                         # Code JavaScript compil√©
‚îú‚îÄ‚îÄ tests/                        # Tests
‚îÇ   ‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îî‚îÄ‚îÄ e2e/
‚îî‚îÄ‚îÄ ...                          # Fichiers de config
```

#### üìö Librairie NPM

```
my-library/
‚îú‚îÄ‚îÄ src/                          # Code source TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ core/                     # Fonctionnalit√©s principales
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ types/                    # D√©finitions de types export√©es
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # Point d'entr√©e public
‚îú‚îÄ‚îÄ lib/                          # Code compil√© pour distribution
‚îú‚îÄ‚îÄ examples/                     # Exemples d'utilisation
‚îú‚îÄ‚îÄ docs/                         # Documentation API
‚îú‚îÄ‚îÄ tests/                        # Tests unitaires
‚îú‚îÄ‚îÄ benchmarks/                   # Tests de performance
‚îú‚îÄ‚îÄ package.json                  # Metadata NPM
‚îú‚îÄ‚îÄ tsconfig.json                 # Config TypeScript
‚îú‚îÄ‚îÄ tsconfig.build.json           # Config build production
‚îú‚îÄ‚îÄ rollup.config.js              # Bundling (optionnel)
‚îî‚îÄ‚îÄ README.md                     # Documentation utilisateur
```

#### üõ†Ô∏è CLI Tool

```
my-cli-tool/
‚îú‚îÄ‚îÄ src/                          # Code source TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ commands/                 # Commandes CLI
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ types/                    # Types
‚îÇ   ‚îú‚îÄ‚îÄ templates/                # Templates de g√©n√©ration
‚îÇ   ‚îú‚îÄ‚îÄ config/                   # Configuration
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # Point d'entr√©e CLI
‚îú‚îÄ‚îÄ bin/                          # Scripts ex√©cutables
‚îú‚îÄ‚îÄ dist/                         # Code compil√©
‚îú‚îÄ‚îÄ tests/                        # Tests
‚îú‚îÄ‚îÄ examples/                     # Exemples d'usage
‚îú‚îÄ‚îÄ package.json                  # Scripts CLI dans "bin"
‚îî‚îÄ‚îÄ README.md                     # Documentation CLI
```

#### ‚ö° Microservice

```
my-microservice/
‚îú‚îÄ‚îÄ src/                          # Code source TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ handlers/                 # Handlers d'√©v√©nements
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # Services m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # Mod√®les de donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ types/                    # Types
‚îÇ   ‚îú‚îÄ‚îÄ config/                   # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ health/                   # Health checks
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # Point d'entr√©e
‚îú‚îÄ‚îÄ docker/                       # Configuration Docker
‚îú‚îÄ‚îÄ k8s/                          # Manifests Kubernetes
‚îú‚îÄ‚îÄ tests/                        # Tests
‚îú‚îÄ‚îÄ Dockerfile                    # Image Docker
‚îî‚îÄ‚îÄ docker-compose.yml            # D√©veloppement local
```

#### üîÑ Worker/Background Jobs

```
my-worker/
‚îú‚îÄ‚îÄ src/                          # Code source TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ jobs/                     # D√©finitions des jobs
‚îÇ   ‚îú‚îÄ‚îÄ processors/               # Processeurs de t√¢ches
‚îÇ   ‚îú‚îÄ‚îÄ queues/                   # Gestion des queues
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # Services m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ types/                    # Types
‚îÇ   ‚îú‚îÄ‚îÄ config/                   # Configuration
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # Point d'entr√©e worker
‚îú‚îÄ‚îÄ dist/                         # Code compil√©
‚îú‚îÄ‚îÄ tests/                        # Tests
‚îî‚îÄ‚îÄ ...                          # Config files
```

#### üèóÔ∏è Monorepo (Lerna/Nx)

```
my-monorepo/
‚îú‚îÄ‚îÄ packages/                     # Packages du monorepo
‚îÇ   ‚îú‚îÄ‚îÄ core/                     # Package core
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ api/                      # Package API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ cli/                      # Package CLI
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ tests/
‚îÇ       ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tools/                        # Outils partag√©s
‚îú‚îÄ‚îÄ docs/                         # Documentation globale
‚îú‚îÄ‚îÄ package.json                  # Root package.json
‚îú‚îÄ‚îÄ lerna.json                    # Configuration Lerna
‚îú‚îÄ‚îÄ nx.json                       # Configuration Nx
‚îî‚îÄ‚îÄ tsconfig.base.json            # Config TypeScript partag√©e
```

### üéØ Versions Compatibles

| Composant | Version Recommand√©e | Version Minimale | Notes |
|-----------|-------------------|------------------|-------|
| **Node.js** | `20.x LTS` | `18.x` | Support √† long terme |
| **TypeScript** | `5.3.x` | `5.0.x` | Derni√®res fonctionnalit√©s |
| **npm** | `10.x` | `9.x` | Gestionnaire de packages |

### üìÑ Configuration de Base

#### `package.json`
```json
{
  "name": "my-typescript-project",
  "version": "1.0.0",
  "description": "Description du projet",
  "main": "dist/index.js",
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=9.0.0"
  },
  "scripts": {
    "build": "tsc",
    "start": "node dist/index.js",
    "dev": "ts-node-dev --respawn --transpile-only src/index.ts",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint src/**/*.ts",
    "lint:fix": "eslint src/**/*.ts --fix",
    "format": "prettier --write src/**/*.ts",
    "type-check": "tsc --noEmit",
    "audit": "npm audit",
    "audit:fix": "npm audit fix",
    "clean": "rimraf dist",
    "prebuild": "npm run clean",
    "prestart": "npm run build"
  },
  "keywords": ["typescript", "node", "api"],
  "author": "Your Name",
  "license": "MIT"
}
```

#### `tsconfig.json`
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "commonjs",
    "lib": ["ES2022"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "removeComments": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noUncheckedIndexedAccess": true,
    "baseUrl": "./src",
    "paths": {
      "@/*": ["*"],
      "@/types/*": ["types/*"],
      "@/utils/*": ["utils/*"]
    }
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "tests"]
}
```

---

## üíª Bonnes Pratiques de Codage

### üéØ Conventions de Nommage

```typescript
// ‚úÖ Bonnes pratiques
class UserService {}                    // PascalCase pour les classes
interface UserData {}                  // PascalCase pour les interfaces
type ApiResponse<T> = {}               // PascalCase pour les types
const API_BASE_URL = 'https://...'     // SCREAMING_SNAKE_CASE pour les constantes
const userName = 'john'                // camelCase pour les variables
function getUserById() {}              // camelCase pour les fonctions

// ‚ùå √Ä √©viter
class userservice {}                   // Mauvaise casse
interface userData {}                 // Mauvaise casse
const apibaseurl = 'https://...'      // Mauvaise casse
```

### üîß Types et Interfaces

```typescript
// ‚úÖ Utiliser des interfaces pour les objets
interface User {
  readonly id: string;
  name: string;
  email: string;
  createdAt: Date;
  updatedAt?: Date;
}

// ‚úÖ Utiliser des types pour les unions et les primitives
type Status = 'pending' | 'approved' | 'rejected';
type UserId = string;

// ‚úÖ G√©n√©riques pour la r√©utilisabilit√©
interface ApiResponse<T> {
  data: T;
  message: string;
  success: boolean;
}

// ‚úÖ Types utilitaires TypeScript
type CreateUserRequest = Omit<User, 'id' | 'createdAt'>;
type UpdateUserRequest = Partial<Pick<User, 'name' | 'email'>>;
```

### üõ†Ô∏è Gestion des Erreurs

```typescript
// ‚úÖ Classes d'erreur personnalis√©es
class AppError extends Error {
  constructor(
    message: string,
    public statusCode: number = 500,
    public isOperational: boolean = true
  ) {
    super(message);
    this.name = this.constructor.name;
    Error.captureStackTrace(this, this.constructor);
  }
}

class ValidationError extends AppError {
  constructor(message: string) {
    super(message, 400);
  }
}

// ‚úÖ Type Result pour la gestion d'erreurs fonctionnelle
type Result<T, E = Error> = 
  | { success: true; data: T }
  | { success: false; error: E };

async function safeApiCall<T>(fn: () => Promise<T>): Promise<Result<T>> {
  try {
    const data = await fn();
    return { success: true, data };
  } catch (error) {
    return { success: false, error: error as Error };
  }
}
```

### üìù Documentation et Commentaires

```typescript
/**
 * Service pour g√©rer les utilisateurs
 * @example
 * ```typescript
 * const userService = new UserService();
 * const user = await userService.getUserById('123');
 * ```
 */
class UserService {
  /**
   * R√©cup√®re un utilisateur par son ID
   * @param id - L'identifiant unique de l'utilisateur
   * @returns Promise qui r√©sout vers l'utilisateur ou null si non trouv√©
   * @throws {ValidationError} Quand l'ID est invalide
   * @throws {AppError} Quand une erreur serveur survient
   */
  async getUserById(id: string): Promise<User | null> {
    if (!id || id.trim().length === 0) {
      throw new ValidationError('User ID is required');
    }
    
    // Impl√©mentation...
    return null;
  }
}
```

> ü§ñ **Pour l'IA :**
> Toujours proposer une fonction `Result<T, E>` en alternative aux blocs `try/catch` si le projet utilise une architecture fonctionnelle.

> üßë‚Äçüíª **Pour les d√©veloppeurs :**
> Ces patterns peuvent √™tre adapt√©s selon l'architecture choisie, mais l'IA doit proposer ces alternatives par d√©faut.

---

## üß¨ Refactoring IA Progressif (SmartRefactor‚Ñ¢)

### üéØ M√©thodologie de Refactorisation

Les IA doivent suivre cette approche progressive pour tout refactoring :

#### 1. üîç Analyse Pr√©alable
```typescript
// @ai-refactor: Identifier les responsabilit√©s unitaires (SRP)
// Avant refactoring, analyser :
// - Une seule responsabilit√© par classe/fonction
// - Couplage faible entre modules
// - Coh√©sion forte √† l'int√©rieur des modules
```

#### 2. üìã Proposition de Diff Minimal
```typescript
// ‚ùå √âviter : Refactoring massif
class UserService {
  // 50 lignes de changements...
}

// ‚úÖ Pr√©f√©rer : Changements atomiques
class UserService {
  // @ai-refactor: Extract method validateEmail
  private validateEmail(email: string): Result<string, ValidationError> {
    // Une seule responsabilit√© : validation email
  }
}
```

#### 3. üß™ Tests Avant Refactorisation
```typescript
// ‚úÖ L'IA doit TOUJOURS proposer des tests avant refactoring structurel
describe('UserService - Before Refactor', () => {
  it('should maintain existing behavior', () => {
    // Test du comportement actuel
  });
});

// Puis proposer le refactoring avec nouveaux tests
describe('UserService - After Refactor', () => {
  it('should validate email correctly', () => {
    // Test du nouveau comportement
  });
});
```

#### 4. üí¨ Messages de Commit Conventionnels
```bash
# ‚úÖ Format requis pour l'IA
refactor(user): extract email validation to separate method

- Extract validateEmail method from createUser
- Improve testability and single responsibility
- No behavior change, only structure improvement

# @ai-refactor: UserService.validateEmail()
```

### üìå R√®gles de Refactoring IA

> ‚ö†Ô∏è **ü§ñ L'IA ne doit jamais :**
> - Modifier plusieurs responsabilit√©s en un seul commit
> - Changer le comportement externe pendant un refactoring
> - Proposer du code sans tests de r√©gression
> - Ignorer les types TypeScript existants

> ‚úÖ **ü§ñ L'IA doit toujours :**
> - Ajouter un commentaire `// @ai-refactor:` dans le code propos√©
> - Proposer un diff minimal et typ√©
> - Inclure des tests avant refactorisation structurelle
> - Respecter les patterns existants du projet

### üì• Exemples de T√¢ches IA Attendues

> üìå **T√¢ches de g√©n√©ration courantes :**
> - `g√©n√®re une route POST /users s√©curis√©e avec validation`
> - `refactore UserService pour appliquer un pattern Repository`
> - `ajoute un middleware de rate-limiting sur /login`
> - `cr√©e un type Result<T, E> pour la gestion d'erreurs`
> - `impl√©mente la validation Joi pour CreateUserDTO`

```typescript
// Exemple : G√©n√©ration automatique d'une route s√©curis√©e
// @ai-refactor: Generated secure route with validation
app.post('/users', 
  rateLimit({ windowMs: 15 * 60 * 1000, max: 5 }),
  validateSchema(createUserSchema),
  async (req: Request, res: Response) => {
    const result = await userService.createUser(req.body);
    if (!result.success) {
      return res.status(400).json({ error: result.error.message });
    }
    res.status(201).json(result.data);
  }
);
```

### üó∫Ô∏è Roadmap de Refactoring IA (SmartRefactor‚Ñ¢)

#### Phase 1: üîç Pr√©paration et Analyse

**1.1 Identification des zones √† refactorer**
```typescript
// @ai-refactor: Analysis phase
interface RefactorAnalysis {
  duplications: CodeDuplication[];
  obsoletePatterns: ObsoletePattern[];
  fragilityPoints: FragilityPoint[];
  complexityScore: number;
  technicalDebt: TechnicalDebtItem[];
}

// L'IA analyse automatiquement :
// - Duplications de code (>3 lignes identiques)
// - Patterns obsol√®tes (callbacks vs async/await)
// - Points de fragilit√© (any types, eval, process.env direct)
// - Complexit√© cyclomatique (>10 = refactor requis)
```

**1.2 √âvaluation de la couverture de tests**
```typescript
// @ai-refactor: Test coverage analysis
interface TestCoverageAnalysis {
  unitTestCoverage: number;      // Minimum 80%
  integrationTests: boolean;     // Requis pour refactoring
  e2eTests: boolean;            // Recommand√©
  criticalPathsCovered: boolean; // Obligatoire
}

// Checklist IA obligatoire :
// ‚úÖ Coverage >80% avant refactoring
// ‚úÖ Tests critiques existants
// ‚úÖ Tests de r√©gression en place
```

#### Phase 2: üìã Planification du Refactoring

**2.1 D√©finition des objectifs SMART**
```typescript
// @ai-refactor: Refactoring objectives
interface RefactorObjectives {
  complexityReduction: {
    current: number;
    target: number;        // Max 10 par fonction
    priority: 'high' | 'medium' | 'low';
  };
  performanceImprovement: {
    metric: 'latency' | 'memory' | 'throughput';
    currentValue: number;
    targetValue: number;
  };
  maintainabilityScore: {
    current: number;       // 1-10
    target: number;        // Minimum 8
  };
  securityLevel: 'basic' | 'moderate' | 'strict';
}
```

**2.2 Priorisation des t√¢ches (Matrice Impact/Faisabilit√©)**
```typescript
// @ai-refactor: Task prioritization matrix
interface RefactorTask {
  id: string;
  description: string;
  impact: 1 | 2 | 3 | 4 | 5;        // 5 = impact critique
  feasibility: 1 | 2 | 3 | 4 | 5;   // 5 = tr√®s facile
  riskLevel: 'low' | 'medium' | 'high';
  estimatedHours: number;
  dependencies: string[];
  priority: 'P0' | 'P1' | 'P2' | 'P3'; // P0 = urgent
}

// Algorithme de priorisation IA :
// Priority = (Impact √ó 2 + Feasibility) / RiskFactor
// P0: Score >8 && RiskLevel = 'low'
// P1: Score 6-8 && RiskLevel ‚â§ 'medium'
```

#### Phase 3: ‚ö° Ex√©cution Automatis√©e

**3.1 Refactoring par √©tapes atomiques**
```typescript
// @ai-refactor: Atomic refactoring steps
interface AtomicRefactorStep {
  stepId: string;
  type: 'extract-method' | 'extract-class' | 'rename' | 'move' | 'inline';
  scope: 'function' | 'class' | 'module' | 'package';
  rollbackPlan: RollbackStep[];
  validationTests: TestCase[];
  maxLinesChanged: 50;  // Limite stricte
}

// Processus IA obligatoire :
// 1. Backup automatique
// 2. Changement atomique (<50 lignes)
// 3. Ex√©cution des tests
// 4. Validation TypeScript
// 5. Commit ou rollback
```

**3.2 G√©n√©ration automatique de tests**
```typescript
// @ai-refactor: Auto-generated tests
interface AutoTestGeneration {
  beforeRefactor: TestSuite;
  afterRefactor: TestSuite;
  regressionTests: TestCase[];
  performanceTests: BenchmarkTest[];
}

// L'IA g√©n√®re automatiquement :
// - Tests de r√©gression pour comportement existant
// - Tests unitaires pour nouvelles m√©thodes extraites
// - Tests d'int√©gration pour interfaces modifi√©es
// - Benchmarks pour validation performance
```

#### Phase 4: ‚úÖ Revue et Validation

**4.1 Code review assist√©e par IA**
```typescript
// @ai-refactor: AI-assisted code review
interface AICodeReview {
  securityIssues: SecurityIssue[];
  performanceImpacts: PerformanceImpact[];
  bestPracticeViolations: BestPracticeViolation[];
  typeScriptIssues: TypeIssue[];
  recommendedImprovements: Improvement[];
}

// Checklist de validation IA :
// ‚úÖ Aucun eval, Function(), process.env direct
// ‚úÖ Types stricts, pas d'any
// ‚úÖ Patterns recommand√©s appliqu√©s
// ‚úÖ S√©curit√© maintenue ou am√©lior√©e
// ‚úÖ Performance maintenue ou am√©lior√©e
```

**4.2 Validation des performances**
```typescript
// @ai-refactor: Performance validation
interface PerformanceValidation {
  beforeMetrics: PerformanceMetrics;
  afterMetrics: PerformanceMetrics;
  regressionThreshold: number;  // Max 5% d√©gradation
  improvementAchieved: boolean;
  benchmarkResults: BenchmarkResult[];
}

// M√©triques surveill√©es :
// - Temps de r√©ponse API
// - Utilisation m√©moire
// - Complexit√© cyclomatique
// - Temps de compilation TypeScript
```

#### Phase 5: üìö Documentation et Suivi

**5.1 Mise √† jour automatique de la documentation**
```typescript
// @ai-refactor: Auto-documentation update
interface DocumentationUpdate {
  apiDocumentation: boolean;     // JSDoc mis √† jour
  architectureGuides: boolean;   // Diagrammes actualis√©s
  changelogEntry: ChangelogEntry;
  migrationGuide?: MigrationGuide;
}

// L'IA met √† jour automatiquement :
// - JSDoc pour nouvelles m√©thodes
// - README si API publique modifi√©e
// - CHANGELOG avec d√©tails techniques
// - Guide de migration si breaking changes
```

**5.2 Suivi continu de la qualit√©**
```typescript
// @ai-refactor: Continuous quality monitoring
interface QualityMonitoring {
  codeQualityScore: number;      // 1-10, objectif >8
  technicalDebtReduction: number; // Pourcentage am√©lior√©
  maintainabilityIndex: number;   // Objectif >85
  nextRefactoringSuggestions: RefactorSuggestion[];
}

// Surveillance continue :
// - M√©triques de qualit√© quotidiennes
// - D√©tection de nouvelles dettes techniques
// - Suggestions proactives d'am√©lioration
// - Alertes si d√©gradation d√©tect√©e
```

### üéØ Template de Commit pour Roadmap

```bash
# Phase 1: Analyse
docs(refactor): add refactoring analysis for UserService

- Identified 3 code duplications in validation logic
- Found 2 obsolete callback patterns
- Complexity score: 12 (target: 8)
- Test coverage: 75% (target: 80%)

# @ai-refactor: Analysis phase completed

# Phase 2: Planification  
plan(refactor): prioritize UserService refactoring tasks

- P0: Extract email validation (Impact: 5, Feasibility: 5)
- P1: Convert callbacks to async/await (Impact: 4, Feasibility: 4)
- P2: Split large methods (Impact: 3, Feasibility: 5)

# @ai-refactor: Planning phase completed

# Phase 3: Ex√©cution
refactor(user): extract email validation method

- Extract validateEmail from createUser method
- Reduce complexity from 12 to 8
- Add unit tests for extracted method
- No behavior change, only structure improvement

# @ai-refactor: UserService.validateEmail() extracted

# Phase 4: Validation
test(refactor): validate UserService refactoring

- Performance maintained: 95ms ‚Üí 92ms
- Test coverage increased: 75% ‚Üí 85%
- No security regressions detected
- TypeScript compilation successful

# @ai-refactor: Validation completed

# Phase 5: Documentation
docs(refactor): update UserService documentation

- Updated JSDoc for new validateEmail method
- Added architecture decision record
- Updated API documentation
- Created migration guide for breaking changes

# @ai-refactor: Documentation updated
```

---

## üì¶ Gestion des D√©pendances

### üéØ Strat√©gie de S√©lection

#### Crit√®res d'√âvaluation
1. **Popularit√©** : `npm trends`, t√©l√©chargements hebdomadaires
2. **Maintenance** : Derni√®re mise √† jour, fr√©quence des releases
3. **S√©curit√©** : Audit de s√©curit√©, vuln√©rabilit√©s connues
4. **Qualit√©** : Tests, documentation, TypeScript support
5. **Taille** : Impact sur le bundle final

#### D√©pendances Recommand√©es

```json
{
  "dependencies": {
    "express": "^4.18.2",
    "helmet": "^7.1.0",
    "cors": "^2.8.5",
    "compression": "^1.7.4",
    "dotenv": "^16.3.1",
    "joi": "^17.11.0",
    "winston": "^3.11.0",
    "axios": "^1.6.2"
  },
  "devDependencies": {
    "typescript": "^5.3.2",
    "@types/node": "^20.9.0",
    "@types/express": "^4.17.21",
    "ts-node-dev": "^2.0.0",
    "jest": "^29.7.0",
    "@types/jest": "^29.5.8",
    "ts-jest": "^29.1.1",
    "eslint": "^8.54.0",
    "@typescript-eslint/parser": "^6.12.0",
    "@typescript-eslint/eslint-plugin": "^6.12.0",
    "prettier": "^3.1.0",
    "rimraf": "^5.0.5"
  }
}
```

### üîí Verrouillage des Versions

```json
{
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=9.0.0"
  },
  "volta": {
    "node": "20.9.0",
    "npm": "10.1.0"
  }
}
```

### üìä Audit et Maintenance

```bash
# Audit de s√©curit√©
npm audit
npm audit --audit-level moderate
npm audit fix

# V√©rification des mises √† jour
npx npm-check-updates
npx npm-check-updates -u

# Analyse des d√©pendances
npx depcheck
npx bundle-phobia <package-name>
```

---

## üõ°Ô∏è S√©curit√©

### üîç Outils de V√©rification

#### Configuration `.npmrc`
```ini
# S√©curit√©
audit-level=moderate
fund=false

# Registry s√©curis√©
registry=https://registry.npmjs.org/
```

#### Scripts de S√©curit√©
```json
{
  "scripts": {
    "security:audit": "npm audit --audit-level moderate",
    "security:check": "npx better-npm-audit audit",
    "security:licenses": "npx license-checker --summary",
    "security:outdated": "npm outdated",
    "precommit": "npm run security:audit && npm run lint && npm run test"
  }
}
```

### üõ°Ô∏è Pratiques de S√©curisation

> ‚ö†Ô∏è **ü§ñ L'IA ne doit jamais proposer un code contenant :**
> - Des acc√®s directs √† `process.env` sans fallback s√©curis√©
> - Des d√©pendances non v√©rifi√©es ou inconnues
> - Des `eval`, `Function()` ou autres constructions dynamiques
> - Des requ√™tes SQL non param√©tr√©es
> - Des uploads de fichiers sans validation de type
> - Des tokens JWT sans expiration

```typescript
// ‚úÖ Validation des entr√©es avec types stricts
import Joi from 'joi';

const userSchema = Joi.object({
  name: Joi.string().min(2).max(50).required(),
  email: Joi.string().email().required(),
  age: Joi.number().integer().min(0).max(120)
});

// ‚úÖ Sanitisation des donn√©es
import helmet from 'helmet';
import rateLimit from 'express-rate-limit';

app.use(helmet());
app.use(rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100 // limite √† 100 requ√™tes par IP
}));

// ‚úÖ Gestion s√©curis√©e des secrets avec fallbacks
import dotenv from 'dotenv';
dotenv.config();

const config = {
  port: parseInt(process.env.PORT || '3000', 10),
  dbUrl: process.env.DATABASE_URL || (() => {
    throw new Error('DATABASE_URL is required in production');
  })(),
  jwtSecret: process.env.JWT_SECRET || (() => {
    if (process.env.NODE_ENV === 'production') {
      throw new Error('JWT_SECRET is required in production');
    }
    return 'dev-secret-key';
  })()
};

// ‚úÖ Sanitisation XSS
import DOMPurify from 'isomorphic-dompurify';

function sanitizeInput(input: string): string {
  return DOMPurify.sanitize(input);
}
```

> ü§ñ **Pour l'IA :**
> Toujours proposer une validation d'entr√©e ET une sanitisation pour tout input utilisateur.

### üîê Variables d'Environnement

```bash
# .env.example
NODE_ENV=development
PORT=3000
DATABASE_URL=postgresql://user:pass@localhost:5432/db
JWT_SECRET=your-super-secret-key
API_KEY=your-api-key

# Logging
LOG_LEVEL=info
LOG_FILE=app.log
```

---

## üîÑ Compatibilit√© des Versions

### üìä Matrice de Compatibilit√©

| Node.js | TypeScript | Support | Recommandation |
|---------|------------|---------|----------------|
| 18.x LTS | 5.0+ | ‚úÖ Active | Production |
| 20.x LTS | 5.0+ | ‚úÖ Active | **Recommand√©** |
| 21.x | 5.0+ | ‚ö†Ô∏è Current | D√©veloppement |
| 16.x | 4.9+ | ‚ùå EOL | Migration requise |

### üéØ Strat√©gie de Migration

#### Node.js 18 ‚Üí 20
```json
{
  "engines": {
    "node": ">=20.0.0"
  },
  "scripts": {
    "check-node": "node --version",
    "migrate": "npm run test && npm run build"
  }
}
```

#### TypeScript 4.x ‚Üí 5.x
```bash
# Mise √† jour progressive
npm install typescript@^5.0.0 --save-dev
npm run type-check
npm run test
```

### üìã Checklist de Compatibilit√©

- [ ] **Node.js** : Version LTS active
- [ ] **TypeScript** : Derni√®re version stable
- [ ] **D√©pendances** : Support des versions cibles
- [ ] **Tests** : Passage sur toutes les versions
- [ ] **CI/CD** : Matrix de tests multi-versions

---

## üöÄ Pipeline CI/CD

### üîß GitHub Actions

```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x, 20.x]
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Security audit
      run: npm audit --audit-level moderate
    
    - name: Lint
      run: npm run lint
    
    - name: Type check
      run: npm run type-check
    
    - name: Test
      run: npm run test:coverage
    
    - name: Build
      run: npm run build
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
```

### üîí Contr√¥les de S√©curit√©

```yaml
  security:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Run Snyk to check for vulnerabilities
      uses: snyk/actions/node@master
      env:
        SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    
    - name: Audit dependencies
      run: |
        npm audit --audit-level high
        npx better-npm-audit audit
```

---

## üìò Lexique pour les Agents IA

### üéØ Terminologie Standard

| Terme | D√©finition | Usage IA |
|-------|------------|----------|
| `@bestcode/core` | C≈ìur des outils IA (types, logique fonctionnelle) | R√©f√©rence pour patterns recommand√©s |
| `atomic commit` | Modification isol√©e ne traitant qu'un seul comportement | **Obligatoire** pour toute suggestion IA |
| `refactor` | Transformation interne sans changement de comportement | Doit inclure `// @ai-refactor:` |
| `sanitization` | Nettoyage des entr√©es utilisateurs contre XSS/Injection | **Requis** pour tout input utilisateur |
| `Result<T, E>` | Type fonctionnel pour gestion d'erreurs sans exceptions | Alternative pr√©f√©r√©e aux `try/catch` |
| `DTO` | Data Transfer Object - objet de transfert de donn√©es | Pour validation et s√©rialisation |
| `Repository Pattern` | Abstraction de la couche de donn√©es | Recommand√© pour acc√®s base de donn√©es |

### ü§ñ Patterns IA Recommand√©s

```typescript
// Pattern Result<T, E> - √Ä proposer syst√©matiquement
type Result<T, E = Error> = 
  | { success: true; data: T }
  | { success: false; error: E };

// Pattern Option<T> - Pour valeurs optionnelles
type Option<T> = T | null;

// Pattern DTO avec validation
interface CreateUserDTO {
  readonly name: string;
  readonly email: string;
  readonly age?: number;
}

// Pattern Repository
interface UserRepository {
  findById(id: string): Promise<Option<User>>;
  create(user: CreateUserDTO): Promise<Result<User, ValidationError>>;
}
```

### üìã Checklist IA Obligatoire

Avant toute suggestion de code, l'IA doit v√©rifier :

- [ ] **S√©curit√©** : Pas d'`eval`, `process.env` s√©curis√©, validation inputs
- [ ] **Types** : TypeScript strict, pas d'`any`, interfaces d√©finies
- [ ] **Tests** : Tests inclus pour nouveau code/refactoring
- [ ] **Atomicit√©** : Une seule responsabilit√© par commit
- [ ] **Documentation** : JSDoc pour fonctions publiques
- [ ] **Patterns** : Utilisation des patterns recommand√©s (Result, Repository)
- [ ] **Performance** : Pas de boucles O(n¬≤), async/await appropri√©

### üö® Interdictions Absolues pour l'IA

```typescript
// ‚ùå JAMAIS proposer
eval(userInput);                    // Ex√©cution de code dynamique
process.env.SECRET;                 // Acc√®s direct sans fallback
const users: any[] = [];            // Type any
function doEverything() {}          // Responsabilit√©s multiples
await Promise.all(heavyTasks);      // Sans limitation de concurrence

// ‚úÖ TOUJOURS proposer
const result = parseUserInput(input);  // Parsing s√©curis√©
const secret = config.getSecret();     // Configuration centralis√©e
const users: User[] = [];              // Types stricts
function validateEmail() {}            // Responsabilit√© unique
const results = await pLimit(5)(tasks); // Concurrence limit√©e
```

---

## üìñ Ressources

### üìö Documentation Officielle
- [Node.js Documentation](https://nodejs.org/docs/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [npm Documentation](https://docs.npmjs.com/)

### üõ†Ô∏è Outils Recommand√©s
- **IDE** : VS Code avec extensions TypeScript
- **Linting** : ESLint + Prettier
- **Testing** : Jest + Supertest
- **Security** : Snyk, npm audit, OWASP ZAP

### üîó Liens Utiles
- [Node.js Security Best Practices](https://nodejs.org/en/security/)
- [TypeScript Do's and Don'ts](https://www.typescriptlang.org/docs/handbook/declaration-files/do-s-and-don-ts.html)
- [npm Security Guidelines](https://docs.npmjs.com/security)

---

## üìù Changelog

### v2.0.0 - AI-Enhanced Release
- ü§ñ Guide sp√©cialis√© pour les agents IA
- üß¨ M√©thodologie SmartRefactor‚Ñ¢
- üìò Lexique et patterns standardis√©s
- üîí S√©curit√© IA-first
- ‚úÖ Checklist obligatoire pour l'IA

### v1.0.0 - Initial Release
- ‚úÖ Structure de projet compl√®te
- ‚úÖ Bonnes pratiques TypeScript
- ‚úÖ Guide de s√©curit√©
- ‚úÖ Pipeline CI/CD
- ‚úÖ Matrice de compatibilit√©

---

**Maintenu par l'√©quipe BestCode** | *Derni√®re mise √† jour : Octobre 2024*
**ü§ñ AI-Friendly Documentation** | *Optimis√© pour les assistants IA*
